<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Karnataka voting system</title>
    <style>
        body {
            display: flex;
        }

        #voteshareResults {
            width: 50%;
        }
    </style>
</head>

<body>
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"
        integrity="sha384-c79GN5VsunZvi+Q/WObgk2in0CbZsHnjEqvFxC5DxHn9lTfNce2WW6h2pH6u/kF+"
        crossorigin="anonymous"></script>
    <div id="voteshareResults">
        Share of Votes for parties
        <div id="container">

            <div>
                <h2> A Party:</h2>
                <p id="a">waiting for first vote </p>
            </div>
            <div>
                <h2> B Party:</h2>
                <p id="b"></p>
            </div>
            <div>
                <h2> C Party:</h2>
                <p id="c"> </p>
            </div>


        </div>
    </div>
    <div id="votingButtons">
        <input type="text" id="voterId" placeholder="enter your voter id">
        <select name="parties" id="parties">
            <option value="">Choose your party to vote</option>
            <option value="a">A party</option>
            <option value="b">B party</option>
            <option value="c">C party</option>

        </select>
        <button id="submitBtn">submit</button>
    </div>
</body>
<script>
    let container = document.getElementById("container")
    let button = document.getElementById("submitBtn")
    let parties = document.getElementById("parties")
    let voterId = document.getElementById("voterId")
    let AV = document.getElementById("a")
    let BV = document.getElementById("b")
    let CV = document.getElementById("c")
    const socket = io("http://localhost:4500/", { transports: ["websocket"] })
    console.log("connection");
    button.addEventListener("click", () => {
        if (voterId.value == "") {
            alert("please put your voter id")
            return
        }
        if (parties.value == "") {
            alert("please select your vote")
            return
        }
        let voteData = {
            party: parties.value,
            voterId: voterId.value
        }
        console.log(voteData);
        socket.emit("msg", { voteData })

    })



    socket.on("voteShare", (voteShare) => {
        console.log(voteShare);
        let totalVote = voteShare[0].a + voteShare[1].b + voteShare[2].c
        console.log(totalVote);

        let aVoteShare = (voteShare[0].a / totalVote) * 100
        let bVoteShare = (voteShare[1].b / totalVote) * 100
        let cVoteShare = (voteShare[2].c / totalVote) * 100
        AV.innerHTML = ` ${aVoteShare.toFixed(2)}%`
        BV.innerHTML = ` ${bVoteShare.toFixed(2)}%`
        CV.innerHTML = ` ${cVoteShare.toFixed(2)}%`
    })



</script>

</html>